<%include ./header.ejs %>


<style>
.depostit-card {
    margin-bottom: 20px;
}
</style>
		
		<!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- row -->	
			<div class="page-titles">
				<ol class="breadcrumb">
					<li><h5 class="bc-title">Dashboard</h5></li>
					<li class="breadcrumb-item"><a href="javascript:void(0)">
						<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2.125 6.375L8.5 1.41667L14.875 6.375V14.1667C14.875 14.5424 14.7257 14.9027 14.4601 15.1684C14.1944 15.4341 13.8341 15.5833 13.4583 15.5833H3.54167C3.16594 15.5833 2.80561 15.4341 2.53993 15.1684C2.27426 14.9027 2.125 14.5424 2.125 14.1667V6.375Z" stroke="#2C2C2C" stroke-linecap="round" stroke-linejoin="round"/>
							<path d="M6.375 15.5833V8.5H10.625V15.5833" stroke="#2C2C2C" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
						Home </a>
					</li>
					<li class="breadcrumb-item active"><a href="javascript:void(0)">Dashboard</a></li>
				</ol>
				<a class="text-primary fs-13" data-bs-toggle="offcanvas" href="#offcanvasExample1" role="button" aria-controls="offcanvasExample1">+ Add Task</a>
			</div>
			<div class="container-fluid">
				<div class="row">
					<div class="col-xl-12 wid-100">
						<div class="row">
							
							<h4 class="heading mb-0" style="margin-bottom: 20px;">Projects Overview</h4>

							<div class="row" style="margin-top: 20px;">


						
								

								<!-- Today Delivered Project -->
								<div class="col-xl-4 col-sm-6">
									<a href="/freelancing/leads/today_deliveries" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Today Project Deliveries</h6>
													<h3><%= result[0][0].today_delivered_project %></h3>
												</div>
												<div class="icon-box bg-success-light">
													<i class="fas fa-truck text-success"></i> <!-- Truck Icon for Delivery -->
												</div>
											</div>
										</div>
									</div>
									</a>
								</div>
							
								<!-- Overdue Projects -->
								<div class="col-xl-4 col-sm-6">
									<a href="/freelancing/leads/overdue" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Overdue Projects</h6>
													<h3><%= result[0][0].overdue_projects %></h3>
												</div>
												<div class="icon-box bg-danger-light">
													<i class="fas fa-exclamation-triangle text-danger"></i> <!-- Warning Icon for Overdue -->
												</div>
											</div>
										</div>
									</div>
									</a>
								</div>
							
								<!-- Upcoming Project Deliveries -->
								<div class="col-xl-4 col-sm-6">
									<a href="/freelancing/leads/next_two_days" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Upcoming Project Deliveries</h6>
													<h3><%= result[0][0].upcoming_project_delieverd %></h3>
												</div>
												<div class="icon-box bg-primary-light">
													<i class="fas fa-calendar-alt text-primary"></i> <!-- Calendar Icon for Upcoming -->
												</div>
											</div>
										</div>
									</div>
									</a>
								</div>
							


							<!-- Client Review Projects -->
<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/client_review" target="_blank">
    <div class="card chart-grd same-card">
        <div class="card-body depostit-card p-0">
            <div class="depostit-card-media d-flex justify-content-between pb-0">
                <div>
                    <h6>Projects Under Client Review</h6>
                    <h3><%= result[0][0].client_review_projects %></h3>
                </div>
                <div class="icon-box bg-info-light">
                    <i class="fas fa-comments text-info"></i> <!-- Comments Icon for Client Review -->
                </div>
            </div>
        </div>
    </div>
	</a>
</div>

<!-- Projects Under Revision -->
<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/in_changes" target="_blank">
    <div class="card chart-grd same-card">
        <div class="card-body depostit-card p-0">
            <div class="depostit-card-media d-flex justify-content-between pb-0">
                <div>
                    <h6>Projects Under Revision</h6>
                    <h3><%= result[0][0].in_changes_projects %></h3>
                </div>
                <div class="icon-box bg-warning-light">
                    <i class="fas fa-edit text-warning"></i> <!-- Edit Icon for Projects in Changes -->
                </div>
            </div>
        </div>
    </div>
	</a>
</div>



								<!-- Total Undelivered Projects -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/upcoming" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Total Undelivered Projects</h6>
													<h3><%= result[0][0].total_undelivered_projects %></h3>
												</div>
												<div class="icon-box bg-dark-light">
													<i class="fas fa-box-open text-dark"></i> <!-- Open Box Icon for Undelivered -->
												</div>
											</div>
										</div>
									</div>
	</a>
								</div>
							
								<!-- In-Progress Projects -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/in_progress" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>In-Progress Projects</h6>
													<h3><%= result[0][0].in_progress_projects %></h3>
												</div>
												<div class="icon-box bg-warning-light">
													<i class="fas fa-tasks text-warning"></i> <!-- Tasks Icon for In Progress -->
												</div>
											</div>
										</div>
									</div>
									</a>
								</div>
							
								<!-- Not Assigned Projects -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/pending" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Not Assigned Projects</h6>
													<h3><%= result[0][0].not_assigned_projects %></h3>
												</div>
												<div class="icon-box bg-secondary-light">
													<i class="fas fa-user-times text-secondary"></i> <!-- User Times Icon for Not Assigned -->
												</div>
											</div>
										</div>
									</div>
	</a>
								</div>
							
								<!-- Hold Projects -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/hold" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Hold Projects</h6>
													<h3><%= result[0][0].hold_projects %></h3>
												</div>
												<div class="icon-box bg-info-light">
													<i class="fas fa-pause-circle text-info"></i> <!-- Pause Circle Icon for Hold -->
												</div>
											</div>
										</div>
									</div>
	</a>
								</div>
							
								<!-- Client Payment Pending -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/client_payment_pending" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Client Payment Pending</h6>
													<h3><%= result[0][0].client_payment_pending %></h3>
												</div>
												<div class="icon-box bg-danger-light">
													<i class="fas fa-credit-card text-danger"></i> <!-- Credit Card Icon for Payment Pending -->
												</div>
											</div>
										</div>
									</div>
	</a>
								</div>
							
								<!-- Agent Payment Pending -->
								<div class="col-xl-4 col-sm-6">
	<a href="/freelancing/leads/agent_payment_pending" target="_blank">
									<div class="card chart-grd same-card">
										<div class="card-body depostit-card p-0">
											<div class="depostit-card-media d-flex justify-content-between pb-0">
												<div>
													<h6>Agent Payment Pending</h6>
													<h3><%= result[0][0].agent_payment_pending %></h3>
												</div>
												<div class="icon-box bg-warning-light">
													<i class="fas fa-money-bill-wave text-warning"></i> <!-- Money Bill Icon for Agent Payment -->
												</div>
											</div>
										</div>
									</div>
									</a>
								</div>
							</div>
							

							

							



					
							
							
							
						</div>




						
					</div>






					
				
				</div>




				<div class="card">
					<div class="card-header">
						<h4 class="mb-0">Priority Projects</h4>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="bg-primary text-white">
									<tr>
										<th>#</th>
										<th>Project Name</th>
										<th>Client Name</th>
										<th>Deadline</th>
										<th>Assigned Agent</th>
										<th>Remarks</th>
										<th>Status</th>
									</tr>
								</thead>
								<tbody>
									<% result[1].forEach((project, index) => { %>
									<tr>
										<td><%= index + 1 %></td>
										<td><%= project.enquiry %></td>
										<td><%= project.name %></td>
										<td><%= project.deadline %></td>
										<td><%= project.agent_name %></td>
										<td><%= project.remarks %></td>

										
										<td>
											<% if (!project.is_project_done && project.deadline === new Date().toISOString().split("T")[0]) { %>
												<span class="badge bg-success">Today Deliveries</span> 
											<% } else if (!project.is_project_done && new Date(project.deadline) < new Date()) { %>
												<span class="badge bg-danger">Overdue</span> 
											<% } else { %>
												<span class="badge bg-warning">Upcoming</span> 
											<% } %>
										</td>
										
										
									</tr>
									<% }); %>
								</tbody>
							</table>
						</div>
					</div>
				</div>
				


				<div class="col-lg-12">
					<div class="chart-container">
					<p style="font-weight: bold;color: #E3302B;font-size: 18px;">Pending Amount : Rs. <%=result[4][0].total_pending_amount%></p>	
						<canvas id="profitChart"></canvas>
					</div>
				</div>


				<h4 class="heading mb-0" style="margin-bottom: 20px;">Monthly Project</h4>

				<div class="row" style="margin-top: 20px;">
					<!-- Monthly Project Count -->
					
					<% 
					const monthNames = [
						'January', 'February', 'March', 'April', 'May', 'June',
						'July', 'August', 'September', 'October', 'November', 'December'
					];
					
					for(let i = 1; i <= 12; i++) { %>
					
					<div class="col-xl-2 col-sm-6">
						<a href="/freelancing/convertedleads/<%= i %>" target="_blank">
							<div class="card chart-grd same-card">
								<div class="card-body depostit-card p-0">
									<div class="depostit-card-media d-flex justify-content-between pb-0">
										<div>
											<h6><%= monthNames[i - 1] %></h6>
											</div>
										<div class="icon-box bg-success-light">
											<i class="fas fa-calendar-alt text-success"></i> <!-- Calendar Icon for Month -->
										</div>
									</div>
								</div>
							</div>
						</a>
					</div>
					
					<% } %>
				</div>



				<h4 class="heading mb-0" style="margin-bottom: 20px;">Workload</h4>



				<div class="row" style="margin-top: 20px;">
					<!-- Today Delivered Project -->
					
					<% for(i=0;i<result[3].length;i++){ %>
					
					<div class="col-xl-2 col-sm-6">
						<a href="/freelancing/workload/<%=result[3][i].assign%>" target="_blank">
						<div class="card chart-grd same-card">
							<div class="card-body depostit-card p-0">
								<div class="depostit-card-media d-flex justify-content-between pb-0">
									<div>
										<h6><%=result[3][i].assign%></h6>
										<h3><%=result[3][i].project_count%></h3>
									</div>
									<div class="icon-box bg-warning-light">
										<i class="fas fa-tasks text-warning"></i> <!-- Tasks Icon for In Progress -->
									</div>
								</div>
							</div>
						</div>
				</a>

					</div>
				
					<% } %>
				


					
				</div>



				<h4 class="heading mb-0" style="margin-bottom: 20px;">Agent Payment Pending</h4>



				<div class="row" style="margin-top: 20px;">
					<!-- Today Delivered Project -->
					
					<% for(i=0;i<result[2].length;i++){ %>
					
					<div class="col-xl-2 col-sm-6">
						<a href="/freelancing/assign/<%=result[2][i].assign%>" target="_blank">
						<div class="card chart-grd same-card">
							<div class="card-body depostit-card p-0">
								<div class="depostit-card-media d-flex justify-content-between pb-0">
									<div>
										<h6><%=result[2][i].assign%></h6>
										<h3><%=result[2][i].project_count%></h3>
									</div>
									<div class="icon-box bg-danger-light">
										<i class="fas fa-credit-card text-danger"></i> <!-- Credit Card Icon for Payment Pending -->
									</div>
								</div>
							</div>
						</div>
				</a>

					</div>
				
					<% } %>
				


					
				</div>
			


			
			
				

			</div>
        </div>
		
        <!--**********************************
            Content body end
        ***********************************-->
		
	
		

		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script>
			fetch('/freelancing/profit/yearly') 
				.then(response => response.json())
				.then(data => {
					const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
					const labels = data.map(d => months[d.month - 1]); // Get month names
					const leadPrices = data.map(d => d.total_lead_price);
					const agentPrices = data.map(d => d.total_agent_price);
					const profits = data.map(d => d.profit);
		
					// Get Chart Canvas
					const ctx = document.getElementById('profitChart').getContext('2d');
		
					// Create a Gradient Background
					const gradientBlue = ctx.createLinearGradient(0, 0, 0, 400);
					gradientBlue.addColorStop(0, 'rgba(0, 0, 255, 0.3)');
					gradientBlue.addColorStop(1, 'rgba(0, 0, 255, 0)');
		
					const gradientRed = ctx.createLinearGradient(0, 0, 0, 400);
					gradientRed.addColorStop(0, 'rgba(255, 0, 0, 0.3)');
					gradientRed.addColorStop(1, 'rgba(255, 0, 0, 0)');
		
					const gradientGreen = ctx.createLinearGradient(0, 0, 0, 400);
					gradientGreen.addColorStop(0, 'rgba(0, 255, 0, 0.3)');
					gradientGreen.addColorStop(1, 'rgba(0, 255, 0, 0)');
		
					// Create Chart
					new Chart(ctx, {
						type: 'line',
						data: {
							labels: labels,
							datasets: [
								{
									label: 'Lead Price',
									data: leadPrices,
									borderColor: 'blue',
									backgroundColor: gradientBlue,
									fill: true,
									tension: 0.3,
									pointRadius: 5,
									pointHoverRadius: 7
								},
								{
									label: 'Agent Price',
									data: agentPrices,
									borderColor: 'red',
									backgroundColor: gradientRed,
									fill: true,
									tension: 0.3,
									pointRadius: 5,
									pointHoverRadius: 7
								},
								{
									label: 'Profit',
									data: profits,
									borderColor: 'green',
									backgroundColor: gradientGreen,
									fill: true,
									tension: 0.3,
									pointRadius: 5,
									pointHoverRadius: 7
								}
							]
						},
						options: {
							responsive: true,
							plugins: {
								legend: {
									position: 'top',
									labels: {
										font: { size: 14, weight: 'bold' },
										color: '#333'
									}
								},
								tooltip: {
									backgroundColor: 'rgba(0,0,0,0.8)',
									titleFont: { size: 14, weight: 'bold' },
									bodyFont: { size: 13 },
									padding: 10
								}
							},
							scales: {
								x: {
									grid: { display: false },
									ticks: { color: '#333', font: { size: 13, weight: 'bold' } }
								},
								y: {
									beginAtZero: true,
									grid: { color: 'rgba(200, 200, 200, 0.2)' },
									ticks: { color: '#333', font: { size: 13, weight: 'bold' } }
								}
							}
						}
					});
				})
				.catch(error => console.error('Error fetching data:', error));
		</script>
		
		<!-- CSS for Styling -->
		<style>
			.chart-container {
				width: 100%;
				/* max-width: 900px; */
				margin: 30px auto;
				padding: 20px;
				background: #fff;
				box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
				border-radius: 10px;
			}
		
			canvas {
				display: block;
				width: 100%;
				height: 100%;
			}
		</style>
		
<%include ./footer.ejs %>
     