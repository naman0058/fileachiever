<% include ./header.ejs %>

<div class="content-body">
  <div class="page-titles">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">CMS</a></li>
      <li class="breadcrumb-item active"><a href="#">Review Hustle Tasks</a></li>
    </ol>
  </div>

  <div class="container-fluid">
    <% if (tasks.length === 0) { %>
      <div class="alert alert-info">No pending tasks to review.</div>
    <% } else { %>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle text-center">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Submitted By</th>
              <th>Description</th>
              <th>Proof</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% tasks.forEach((task, index) => { %>
              <tr>
                <td><%= index + 1 %></td>
               
                <td><%= task.task_type.charAt(0).toUpperCase() + task.task_type.slice(1) %></td>
                <td><strong><%= task.ambassador_name %></strong></td>
                <td style="
  max-width: 300px;
  
  white-space: normal;
" title="<%= task.description.replace(/(<([^>]+)>)/gi, '') %>">
  <%= task.description.replace(/(<([^>]+)>)/gi, '') %>
</td>
                <td>
                  <a href="<%= task.proofLink %>" target="_blank" class="btn btn-sm btn-link text-primary">View</a>
                </td>
                <td>
                  <form method="POST" action="/affiliate/update-hustle-task-status" class="d-flex justify-content-center gap-1 reject-form">
                    <input type="hidden" name="taskId" value="<%= task.submissionId %>" />
                    <input type="hidden" name="reason" class="reject-reason-input" />

                    <button type="submit" name="status" value="verified" class="btn btn-success btn-sm">
                      Verified
                    </button>

                    <button type="button" class="btn btn-danger btn-sm reject-btn">
                      Reject
                    </button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</div>

<% include ./footer.ejs %>

<script>
  document.querySelectorAll('.reject-btn').forEach(button => {
    button.addEventListener('click', function () {
      const reason = prompt("Please enter the reason for rejection:");
      if (reason !== null && reason.trim() !== "") {
        const form = this.closest('form');
        const input = form.querySelector('.reject-reason-input');
        input.value = reason;

        const hiddenReject = document.createElement('input');
        hiddenReject.type = 'hidden';
        hiddenReject.name = 'status';
        hiddenReject.value = 'rejected';
        form.appendChild(hiddenReject);
        form.submit();
      } else {
        alert("Rejection reason is required.");
      }
    });
  });
</script>
